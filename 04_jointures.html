<!-- Démarrage SQL : repos sur OS (C:) -->

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    
    <title>Cours SQL - Requêtes imbriquées - BDD bibliotheque </title>

    <link rel="stylesheet" href="css/styles.css">
</head>

<body>

    <!-- =================================== -->

    <!-- Pour une navbar Bootstrap sans la fleche :
        https://www.it-swarm-fr.com/fr/css/comment-supprimer-la-fleche-dans-la-liste-deroulante-dans-bootstrap-4/827351415/-->

    <!-- =================================== -->


    <!-- ======= -->
    <!-- en-tête -->
    <!-- ======= -->

    <header class="container-fluid p-4">
        <div class="row">
            <div class="col-12 text-center">
                <h1 class="display-4 text-dark">Cours SQL - Requêtes de jointures # 4</h1>
                <p class="lead">Jointures SQL</p>
            </div>
        </div>
        <!-- fin row  -->
    </header>

    <!-- debut div de la row caroussel -->
    <div class="d-flex mb-4 mt- p-4 justify-content-center">
        <!-- debut row -->
        <div class="row col-6">
            <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel" data-interval="2500">
                <div class="carousel-inner">

                    <div class="carousel-item active">
                        <img src="img/langage.png"class="d-block w-100" alt="logo sql">
                    </div>

                    <div class="carousel-item">
                        <img src="img/index.png"class="d-block w-100" alt="logo sql">
                    </div>

                    <div class="carousel-item">
                        <img src="img/php-apache-postgresql-logo.png"class="d-block w-100" alt="logo sql">
                    </div>

                    <div class="carousel-item">
                        <img src="img/conception-logo-sql-ou-base-données-icône-ux-app-ui-clipart-vecteur_csp49313056.webp"class="d-block w-100" alt="logo sql">
                    </div>

                    <div class="carousel-item">
                        <img src="img/sql.jpg"class="d-block w-100" alt="logo sql">
                    </div>

                    <div class="carousel-item">
                        <img src="img/php.jpg" class="d-block w-100" alt="logo php">
                    </div>

                    <div class="carousel-item">
                        <img src="img/pma.jpg" class="d-block w-100" alt="logo pma">
                    </div>               
                </div>
              </div>
        </div>
        <!-- fin row -->
    </div>
    <!-- fin div caroussel -->

    <!-- corps central avec contenu principal -->
    <main class="row container-fluid mx-auto bg-light">

        <!-- aside gauche avec nav sommaire -->
        <div class="col-3 p-5 bg-grisclair">

            <!-- nav pour la page index : sommaire -->
            <nav id="navbar-example3" class="navbar navbar-light bg-light flex-column align-items-stretch p-3">
                <a class="navbar-brand" href="#index">Page Index - Sommaire</a>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link" href="#introduction">1. Introduction</a>
                    <a class="nav-link" href="#modelisation">2. Modélisation</a>
                    <a class="nav-link" href="#tables">3. Les tables </a>
                    <a class="nav-link" href="#les_colonnes">4. Les colonnes ou les champs </a>
                    <a class="nav-link" href="#les_types_de_donnees">5. Les types de données</a>
                    <a class="nav-link" href="#pk_ai_id">6. Types de données PK AI pour ID</a>
                    <a class="nav-link" href="#les_cardinalites">7. Les cardinalités</a>
                    <a class="nav-link" href="#table de jointure">8.Table de jointure</a>
                    <a class="nav-link" href="#clefs_etrangères">9. Clefs étrangères ou FK</a>
                    <a class="nav-link" href="#les_enregistrements">10. Les enrégistrements</a>
                    <a class="nav-link" href="#interroger_la_bdd">11. Intérroger la BDD </a>
                </nav>

                 <!-- nav pour la page 01_requêtes -->
                <a class="navbar-brand" href="#">Page 01 - Requêtes</a>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link" href="#introduction">1. Base d'une BDD</a>
                    <a class="nav-link" href="#modelisation">2. Création d'une table</a>
                    <a class="nav-link" href="#tables">3. SELECT et DISTINCT</a>
                    <a class="nav-link" href="#les_colonnes">4. Les conditions</a>
                    <a class="nav-link" href="#les_types_de_donnees">5. Les opérateurs de comparaison</a>
                    <a class="nav-link" href="#pk_ai_id">6. ORDER BY</a>
                    <a class="nav-link" href="#les_cardinalites">7. Limitation avec LIMIT</a>
                    <a class="nav-link" href="#table de jointure">8. Faire des calculs</a>
                    <a class="nav-link" href="#clefs_etrangères">9. Les conditions multiples</a>
                    <a class="nav-link" href="#les_enregistrements"> Les regroupements</a>
                </nav>

                <!-- nav pour la page 02_requêtes -->
                <a class="navbar-brand" href="#">Page 02 - Requêtes</a>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link" href="#INSERT INTO, insertion">1. INSERT INTO, insertion</a>
                    <a class="nav-link" href="#modelisation">2. UPDATE, mise à jour</a>
                    <a class="nav-link" href="#tables">3. DELETE, effacer</a>
                    <a class="nav-link" href="#les_colonnes">4. Exo</a>
                </nav>

                <!-- nav pour la page 03_requêtes imbriquées -->
                <a class="navbar-brand" href="#">Page 03 - Requêtes imbriquées</a>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link" href="#">1. </a>
                    <a class="nav-link" href="#">2. </a>
                    <a class="nav-link" href="#">3. </a>
                    <a class="nav-link" href="#">4. </a>
                </nav>

                <!-- nav pour la page 04_jointures -->
                <a class="navbar-brand" href="#">Page 04 - Jointures</a>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link" href="#">1. </a>
                    <a class="nav-link" href="#">2. </a>
                    <a class="nav-link" href="#">3. </a>
                    <a class="nav-link" href="#">4. </a>
                </nav>

                <!-- nav pour la page 05_exos -->
                <a class="navbar-brand" href="#">Page 05 - exos</a>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link" href="#">1. </a>
                    <a class="nav-link" href="#">2. </a>
                    <a class="nav-link" href="#">3. </a>
                    <a class="nav-link" href="#">4. </a>
                </nav>
            </nav>
        </div>

        <!-- ================================================ -->
        <!-- section container : avec contenu principal-->
        <!-- ================================================ -->
    
        <section class="container mb-4 p-4 bg-light col-9">

            <div class="row">
                <h2>1- Définition</h2>
                <dl>
                    <dt>Les jointures</dt>
                    <dd>Les jointures permettent, comme les requêtes imbriquées, d'effectuer les requêtes sur plusieurs tables. Il faut un champ commun aux différentes tables. L'avantage des jointures est que l'on peut obtenir un résultat final des colonnes ou champs issus de plusieurs tables différentes.
                    </dd>
                </dl>
            </div>
            <!-- fin row -->

            <div class="row">
                <div class="col-md-12">
                    <h3>a) Récapitulatif</h3>

                    <!-- ul>li*5{:}code -->

                    <ul>
                        <li><code>SELECT</code> : liste des champs que je souhaite afficher dans mon résultat</li>
                        <li><code>FROM</code> : de quelle table cela provient-il ?</li>
                        <li><code>WHERE</code> : condition de jointure pour assurer le croisement des données</li>
                        <li><code>AND / OR</code> : autre condition éventuellle</li>
                    </ul>
                </div>
                <!-- fin col -->
                
                <div class="col-md-12">
                    <h3>Exemples</h3>
                  
                    <ol>
                        <li>Afficher les dates quxquelles Guillaume s'est rendu à la bibliothèque pour emprunter ou rendre un livre. On a besoin de 3 colonnes : le prénom, la date de sortie et la date de rendu : <br>
                            <code>SELECT abonne.prenom, emprunt.date_sortie, emprunt.date_rendu
                            FROM abonne, emprunt
                            WHERE abonne.id_abonne = emprunt.id_abonne 
                            AND abonne.prenom = 'Guillaume'</code></li><br>

                        <li>Qui a emprunté le livre "Une Vie" en 2014 ? <br>
                            <code>SELECT abonne.prenom <br>
                                FROM abonne, emprunt, livre WHERE livre.id_livre = emprunt.id_livre <br>
                                AND emprunt.id_abonne = abonne.id_abonne <br>
                                AND livre.titre = 'Une vie' <br>
                                AND emprunt.date_sortie LIKE '2014%';</code><br>
                        </li><br>

                        <li>Afficher le nombre de livre(s) emprunté(s) par chaque abonné (il faut la virgule avant COUNT !):
                            <code>SELECT abonne.prenom, COUNT(emprunt.id_livre) AS 'nombre de livres empruntés' <br>
                                FROM abonne, emprunt <br>
                                WHERE abonne.id_abonne = emprunt.id_abonne <br>
                                GROUP BY emprunt.id_abonne<br>
                            </code><br>

                            <ul>
                                <li class="alert alert-success">
                                    La même requête avec des préfixes (à chaque table on met un préfixe dans le FROM - "from" sert pour indiquer les tables) : Ex.: "FROM abonne a, emprunt e" (on lit : a pour abonne, e pour emprunt) <br>
        
                                    <code>SELECT a.prenom, COUNT(e.id_livre) AS 'nombre de livres empruntés' <br>
                                        FROM abonne a, emprunt e <br>
                                        WHERE a.id_abonne = e.id_abonne <br>
                                        GROUP BY e.id_abonne
                                    </code>
                                </li>
                            </ul>
                        </li><br>                  

                        <li>Afficher qui a emprunté QUOI et QUAND. L'indice : (qui = prénom, quoi = titre / quand = date de sortie)<br>
                            <code>SELECT abonne.prenom, livre.titre, emprunt.date_sortie <br>
                                FROM abonne, livre, emprunt WHERE abonne.id_abonne = emprunt.id_abonne <br>
                                AND livre.id_livre = emprunt.id_livre <br>
                                ORDER BY abonne.prenom ASC; <br>
                            </code><br>

                            <ul>
                                <li  class="alert alert-success">
                                    La même requête avec des préfixes : <br>

                                    <code>SELECT a.prenom, l.titre, e.date_sortie<br>
                                        FROM abonne a, livre l, emprunt e<br>
                                        AND l.id_livre = e.id_livre<br>
                                        ORDER BY a.prenom ASC<br>
                                    </code>
                                </li>
                            </ul>
                        </li> <br>

                        <li>Afficher les prénoms des abonnés avec l'id des livres qu'ils ont empruntés. ici on cherche les prenom dans la table "abonne", l'id_livre dans la table "emprunt" (SELECT), puis on dit dans FROM quelles sont les tables recherchées, puis dans WHERE on mets les id_communs pour les tables recherchées : <br>

                            <code>SELECT abonne.prenom, emprunt.id_livre<br>
                                FROM abonne, emprunt<br>
                                WHERE abonne.id_abonne = emprunt.id_abonne;<br>
                            </code> <br>

                            <ul>
                                <li class="alert alert-success">
                                    La même requête avec des préfixes : <br>
        
                                    <code>SELECT ab.prenom, em.id_livre<br>
                                        FROM abonne ab, emprunt em<br>
                                        WHERE ab.id_abonne = em.id_abonne;<br>
                                    </code>
                                </li><br>
                            </ul>
                        </li><br>

                        <!-- ci dessous un copié collé pour la suite : -->
                        
                        <li>Afficher les prénoms des abonnés avec l'id des livres qu'ils ont empruntés. ici on cherche les prenom dans la table "abonne", l'id_livre dans la table "emprunt" (SELECT), puis on dit dans FROM quelles sont les tables recherchées, puis dans WHERE on mets les id_communs pour les tables recherchées : <br>

                            <code>SELECT abonne.prenom, emprunt.id_livre<br>
                                FROM abonne, emprunt<br>
                                WHERE abonne.id_abonne = emprunt.id_abonne;<br>
                            </code> <br>

                            <ul>
                                <li class="alert alert-success">
                                    La même requête avec des préfixes : <br>
        
                                    <code>SELECT ab.prenom, em.id_livre<br>
                                        FROM abonne ab, emprunt em<br>
                                        WHERE ab.id_abonne = em.id_abonne;<br>
                                    </code>
                                </li><br>
                            </ul>
                        </li><br>          

                    </ol>
                    <!-- fin liste ordonnée -->
                </div>
                <!-- fin col -->

                <div class="col-md-6">
                    <h3>b) Jointures externes</h3>
    
                    <ul>
                        <li>Afficher le prénom des abonnés avec le numéro des livres qu'ils on empruntés : <br>
                            <code>
                                SELECT abonne.prenom, emprunt.id_livre
                                FROM abonne LEFT JOIN emprunt
                                ON abonne.id_abonne = emprunt.id_abonne
                            </code><br>
                            
                            SELECT : nous selectionons le champ prenom et id_livre. <br>
                            FROM et LEFT JOIN : la table placée à gauche de l'expression LEFT JOIN (la table abonne) sera la table dont tous les résultats seront rapatriés (sans correspondance exigée dans l'autre table) <br>
                            ON : la condition de fait par le mot-clef ON et non plus WHERE, dans le cadre d'une requête LEFT JOIN ou RIGHT JOIN (FULL JOIN n'est pas valable en SQL)
                        </li>
                    </ul>
                </div>
                <!-- fin col -->

                <div class="col-md-6">
                    <h3>c) Jointures externes avec <code>UNION</code></h3>

                    <p>Il est possible de fusionner 2 résultats en 1 seul grâce au mot-clef <code>UNION</code></p>
    
                    <ul>
                        <li>Nous fusionons la liste d'abonnés avec la liste des auteurs. UNION fait comme UNION DISTINCT : il évite les doublons (Maupassant aparâit 1 fois alors qu'il a 2 livres dans la BDD) :<br>
                            <code>
                                SELECT auteur AS 'nom des personnes physiques' <br>
                                FROM livre <br>
                                UNION <br>
                                SELECT prenom <br>
                                FROM abonne <br>
                            </code><br>
                            
                            SELECT : nous selectionons le champ prenom et id_livre. <br>
                            FROM et LEFT JOIN : la table placée à gauche de l'expression LEFT JOIN (la table abonne) sera la table dont tous les résultats seront rapatriés (sans correspondance exigée dans l'autre table) <br>
                            ON : la condition de fait par le mot-clef ON et non plus WHERE, dans le cadre d'une requête LEFT JOIN ou RIGHT JOIN (FULL JOIN n'est pas valable en SQL)
                        </li>
                    </ul>
                </div>
                <!-- fin col -->

            </div>
            <!-- fin row -->

        </section>
        <!-- fin container -->
    </main>
    <!-- fin corps central -->


    <!-- =================================== -->
    <!-- pied de page -->
    <!-- =================================== -->
    
        <!-- Ajouter "container" if you want to extend the Footer to full width/ou container-fluid -->
    <div class="p-5 my-5">

        <footer class="text-center text-lg-start bg-jaune">
            <!-- <div class="container d-flex justify-content-center py-5">
                <button type="button" class="btn-lg btn-floating mx-2" style="background-color: #54456b;">
                <i class="fab fa-facebook-f"></i>
                </button>
    
                <button type="button" class="btn btn-primary btn-lg btn-floating mx-2" style="background-color: #54456b;">
                <i class="fab fa-youtube"></i>
                </button>
    
                <button type="button" class="btn btn-primary btn-lg btn-floating mx-2" style="background-color: #54456b;">
                <i class="fab fa-instagram"></i>
                </button>
    
                <button type="button" class="btn btn-primary btn-lg btn-floating mx-2" style="background-color: #54456b;">
                <i class="fab fa-twitter"></i>
                </button>
            </div> -->

            <!-- Copyright -->
            <div class="text-center text-dark p-5 m-5" style="background-color: rgba(0, 0, 0, 0.2);">
                &copy; Colombbus 2021-2022 :
                <a class="text-dark" href="https://mdbootstrap.com/">Agence Suresnes</a>
            </div>
            <!-- Copyright -->     
        </footer>    
  </div>
  <!-- fin div container/fluid du footer -->

    <!-- Optional JavaScript -->
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
</body>
</html>